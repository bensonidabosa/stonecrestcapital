{% load humanize %}
<div class="table-responsive">
<table class="table table-hover align-middle mb-0">
    <thead class="table-light">
        <tr>
            <th>Type</th>
            <th>Asset</th>
            <th>Quantity</th>
            <th>Avg Price</th>
            <th>Current Price</th>
            <th>Market Value</th>
            <th>Allocated</th>
            <th>Difference</th>
            {% if holdings.0.asset.asset_type == "CRYPTO" %}
            <th>Min Trade Qty</th>
            {% endif %}
            {% if holdings.0.asset.asset_type == "REIT" %}
            <th>Yield</th>
            {% endif %}
            <th>P/L</th>
            <th>P/L %</th>
        </tr>
    </thead>
    <tbody>
        {% for holding in holdings %}
        <tr>
            <!-- Asset Type Badge -->
            <td>
                {% if holding.asset.asset_type == "CRYPTO" %}
                    <span class="badge bg-info">{{ holding.asset.asset_type }}</span>
                {% elif holding.asset.asset_type == "REIT" %}
                    <span class="badge bg-warning">{{ holding.asset.asset_type }}</span>
                {% else %}
                    <span class="badge bg-primary">{{ holding.asset.asset_type }}</span>
                {% endif %}
            </td>

            <!-- Asset Symbol -->
            <td><strong>{{ holding.asset.symbol }}</strong></td>

            <!-- Quantity & Avg Price -->
            <td>{{ holding.quantity|floatformat:holding.decimals }}</td>
            <td>${{ holding.average_price|floatformat:holding.decimals|intcomma }}</td>

            <!-- Current Price & Market Value -->
            <td>${{ holding.asset.price|floatformat:holding.decimals|intcomma }}</td>
            <td>${{ holding.market_value_calc|floatformat:2|intcomma }}</td>

            <!-- Allocated & Difference -->
            <td>${{ holding.allocated_cash|floatformat:2|intcomma }}</td>
            <td>
                <span class="{% if holding.difference >= 0 %}text-success{% else %}text-danger{% endif %}">
                    ${{ holding.difference|floatformat:2|intcomma }}
                </span>
            </td>

            <!-- Extra Fields -->
            {% if holding.asset.asset_type == "CRYPTO" %}
            <td>{{ holding.asset.min_trade_quantity|floatformat:holding.decimals }}</td>
            {% elif holding.asset.asset_type == "REIT" %}
            <td>{{ holding.asset.annual_yield }}%</td>
            {% endif %}

            <!-- P/L & P/L % -->
            <td>
                <span class="{% if holding.unrealized_pnl_calc >= 0 %}text-success{% else %}text-danger{% endif %}">
                    ${{ holding.unrealized_pnl_calc|floatformat:2|intcomma }}
                </span>
            </td>
            <td>
                <span class="{% if holding.unrealized_pnl_percent_calc >= 0 %}text-success{% else %}text-danger{% endif %}">
                    {{ holding.unrealized_pnl_percent_calc|floatformat:2 }}%
                </span>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="12" class="text-center text-muted py-4">No holdings yet</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>
