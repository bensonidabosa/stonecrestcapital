{% load humanize %}
<div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
    <thead class="table-light">
        <tr>
            <th>Type</th>
            <th>Asset</th>
            <th>Quantity</th>
            <th>Avg Price</th>
            <th>Current Price</th>
            <th>Market Value</th>
            <th>Allocated</th>
            <th>Difference</th>
            {% if asset_type == "CRYPTO" %}
            <th>Min Trade Qty</th>
            {% endif %}
            {% if asset_type == "REIT" %}
                <th>Yield</th>
            {% endif %}
            <th>P/L</th>
            <th>P/L %</th>
        </tr>
    </thead>

    <tbody>
        {% if asset_type == "CRYPTO" %}
            {% with decimals=8 %}
                {% for holding in holdings %}
                <tr>
                    <td><span class="badge bg-info">{{ holding.asset.asset_type }}</span></td>
                    <td><strong>{{ holding.asset.symbol }}</strong></td>
                    <td>{{ holding.quantity|floatformat:decimals }}</td>
                    <td>${{ holding.average_price|floatformat:decimals|intcomma }}</td>
                    <td>${{ holding.asset.price|floatformat:decimals|intcomma }}</td>
                    <td>${{ holding.market_value|floatformat:2|intcomma }}</td>
                    
                    <td>${{ holding.allocated_cash|floatformat:2|intcomma }}</td>
                    <td>
                        <span class="{% if holding.difference >= 0 %}text-success{% else %}text-danger{% endif %}">
                            ${{ holding.difference|floatformat:2|intcomma }}
                        </span>
                    </td>
                    
                    <td>{{ holding.asset.min_trade_quantity|floatformat:decimals }}</td>
                    <td>
                        {% with pnl=holding.unrealized_pnl %}
                        <span class="{% if pnl >= 0 %}text-success{% else %}text-danger{% endif %}">
                            {{ pnl|floatformat:2|intcomma }}
                        </span>
                        {% endwith %}
                    </td>
                    <td>
                        <span class="{% if holding.unrealized_pnl_percent >= 0 %}text-success{% else %}text-danger{% endif %}">
                            {{ holding.unrealized_pnl_percent|floatformat:2 }}%
                        </span>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="12" class="text-center text-muted py-4">No holdings yet</td>
                </tr>
                {% endfor %}
            {% endwith %}
        {% else %}
            {% with decimals=2 %}
                {% for holding in holdings %}
                <tr>
                    <td><span class="badge bg-primary">{{ holding.asset.asset_type }}</span></td>
                    <td><strong>{{ holding.asset.symbol }}</strong></td>
                    <td>{{ holding.quantity|floatformat:decimals }}</td>
                    <td>${{ holding.average_price|floatformat:decimals|intcomma }}</td>
                    <td>${{ holding.asset.price|floatformat:decimals|intcomma }}</td>
                    <td>${{ holding.market_value|floatformat:2|intcomma }}</td>
                    <td>${{ holding.allocated_cash|floatformat:2|intcomma }}</td>
                    <td>
                        <span class="{% if holding.difference >= 0 %}text-success{% else %}text-danger{% endif %}">
                            ${{ holding.difference|floatformat:2|intcomma }}
                        </span>
                    </td>
                    {% if holding.asset.asset_type == "REIT" %}
                        <td>
                            {{ holding.asset.annual_yield }}%  
                        </td>
                    {% endif %}
                    <td>
                        {% with pnl=holding.unrealized_pnl %}
                        <span class="{% if pnl >= 0 %}text-success{% else %}text-danger{% endif %}">
                            {% if holding.asset.asset_type == "REIT" %}
                                â€” 
                            {% else %}
                                {{ pnl|floatformat:2|intcomma }}
                            {% endif %}
                        </span>
                        {% endwith %}
                    </td>
                    <td>
                        <span class="{% if holding.unrealized_pnl_percent >= 0 %}text-success{% else %}text-danger{% endif %}">
                            {{ holding.unrealized_pnl_percent|floatformat:2 }}%
                        </span>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="10" class="text-center text-muted py-4">No holdings yet</td>
                </tr>
                {% endfor %}
            {% endwith %}
        {% endif %}
    </tbody>
</table>
</div>
